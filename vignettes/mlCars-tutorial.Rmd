---
title: "Big Data and Machine Learning for transport data analysis: A tutorial"
author: "Robin Lovelace and Liam Bolton"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{mlCars-tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction
This tutorial will provide a very brief overview of what you can do with the mlCars package. Here, we focus on exploring the data, performing regression analysis and some basic machine learning. To find out more about the DfT-funded mlCars project, visit...

To reproduce the results demonstrated in this tutorial we assume that:
- You have some experience with programming in general or are not completely new to R. If you are new to R, we recommend you carry out a a few hours of this free [introductory course](https://www.datacamp.com/courses/free-introduction-to-r) from [Datacamp](https://www.datacamp.com/courses/free-introduction-to-r).
- Up-to-date versions of R and RStudio are installed on your system. See online resources such as [Efficient R Programming](https://csgillespie.github.io/efficientR/set-up.html#installing-r) [@gillespie_efficient_2016] for more info.

## Data
A note about the **data**: the input data for this tutorial is an origin-destination matrix of travel patterns derived from the 2011 census and augmented with additional variables from open census and OSM data. These are represented as spatial lines (of class `SpatialLinesDataFrame` but which could be exported to a range of geographic data formats). It is not the purpose of this tutorial to explain how such datasets can be generated. This is covered in the [vignette](https://cran.r-project.org/web/packages/stplanr/vignettes/introducing-stplanr.html) of the [stplanr R package](https://github.com/ropensci/stplanr).

From your RStudio session, the necessary packages and data can be installed with the following commands, which install the **devtools** and **mlCars** packages:

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("robinlovelace/mlCars")
```

The **mlCars** package contains the example data used in this tutorial. Load it with the `library()` command:

```{r}
library(mlCars)
```

The main input files resulting from the preprocessing stages is `wyflows`, which can be loaded with the following command:

```{r}
wyflows = readRDS("wyflows.Rds")
```

The first thing to do with this data is to gain a basic understanding of it:

```{r}
class(wyflows)
```

Let's have a look at the variables
```{r}
names(wyflows)
```

Inspect the last few rows
```{r}
tail(wyflows)
```

Take a look at some summary stats
```{r}
summary(wyflows$car)
```

Let's create a quick visualisations to explore the dataset. First, a boxplot showing the distribution of car distance counts
```{r}
boxplot(wyflows$car)
```

How about a map showing car flows in West Yorkshire?
```{r, echo=FALSE}
library(tmap)
library(dplyr)
library(sp)
wyflows = spTransform(wyflows, CRS("+init=epsg:4326"))
wyflows_all = wyflows
wyflows = wyflows[wyflows$distance > 0,]
qtm(wyflows[wyflows$npeople > 200,], lines.col = "car", lines.style = "pretty")
```

We can perform some regression analysis to find out whether there is a statistical relationship between car ownership and health
```{r}
Health <- lm(car ~ vghealth + ghealth + fhealth + bhealth + vbhealth + q1624 + q2534 + q3549 + q5064 + q6574 + q75plus, data=df.wyflows)
summary(Health)
```

Machine learning...
XGBoost

## Conclusion
We've broadly covered some of the things you can do with the [mlCars](https://github.com/Robinlovelace/mlCars/) package. If you'd like to learn more about the mlCars package... You can access more code from the repository at [`preprocess.R`](https://github.com/Robinlovelace/mlCars/blob/master/vignettes/preprocess.R) and [`geo.R`](https://github.com/Robinlovelace/mlCars/blob/master/vignettes/geo.R).
